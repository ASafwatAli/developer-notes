(window.webpackJsonp=window.webpackJsonp||[]).push([[274],{"./manual/Kubernetes/EKS-In-Depth.md":function(e,t,a){"use strict";a.r(t),a.d(t,"default",function(){return r});var n=a("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),o=(a("./node_modules/react/index.js"),a("./node_modules/@mdx-js/react/dist/index.es.js")),l={},i="wrapper";function r(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(o.b)(i,Object.assign({},l,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"eks-in-depth"},"EKS in Depth"),Object(o.b)("p",null,"This is more of a basic theory section to understand how EKS works."),Object(o.b)("h2",{id:"pricing"},"Pricing"),Object(o.b)("p",null,"USD$0.20 per hours for each EKS cluster you make. That's ~USD$144/month."),Object(o.b)("p",null,"You pay normally for all the other resources related to running your apps:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Worker nodes (EC2)"),Object(o.b)("li",{parentName:"ul"},"EBS volumes"),Object(o.b)("li",{parentName:"ul"},"Network traffic"),Object(o.b)("li",{parentName:"ul"},"Load balancers")),Object(o.b)("p",null,"Check online for if pricing ever changes."),Object(o.b)("h2",{id:"eks-control-place"},"EKS Control Place"),Object(o.b)("p",null,"The control plane sets up the cluster to be highly available (in 3 availability zones)."),Object(o.b)("p",null,"Each AZ will have a master node and etcd that is AWS managed. The workers nodes are what we supply."),Object(o.b)("p",null,"Our local ",Object(o.b)("inlineCode",{parentName:"p"},"kubectl")," will talk directly to EKS."),Object(o.b)("h3",{id:"under-the-hood"},"Under the hood"),Object(o.b)("p",null,Object(o.b)("img",{alt:"Under the hood",src:"https://res.cloudinary.com/gitgoodclub/image/upload/v1548213794/eks-course/Screen_Shot_2019-01-23_at_2.22.40_pm.png"})),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Single tenant (you do not share it with other customers)"),Object(o.b)("li",{parentName:"ul"},"Made of native AWS component (EC2, ELB, ASG, NLB, VPC)")),Object(o.b)("h2",{id:"eks-networking"},"EKS Networking"),Object(o.b)("p",null,Object(o.b)("img",{alt:"Network",src:"https://res.cloudinary.com/gitgoodclub/image/upload/v1548213958/eks-course/Screen_Shot_2019-01-23_at_2.25.49_pm.png"})),Object(o.b)("p",null,"Recommended to have:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Private subnets: containers all the worker nodes to have application deployed. Must be large CIDR."),Object(o.b)("li",{parentName:"ol"},"Public subnets: Will contain any internet-facing load balancer to expose the applications."),Object(o.b)("li",{parentName:"ol"},"The VPC must have DNS hostname and DNS resolution support, otherwise nodes can't register.")),Object(o.b)("h3",{id:"security-groups"},"Security groups"),Object(o.b)("p",null,Object(o.b)("img",{alt:"Security groups explored",src:"https://res.cloudinary.com/gitgoodclub/image/upload/v1548214249/eks-course/Screen_Shot_2019-01-23_at_2.30.35_pm.png"})),Object(o.b)("p",null,"You have 2 security groups: ",Object(o.b)("inlineCode",{parentName:"p"},"Control Plane")," and ",Object(o.b)("inlineCode",{parentName:"p"},"Worker Nodes"),"."),Object(o.b)("p",null,"Read up on ",Object(o.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/freach/kubernetes-security-best-practice"}),"https://github.com/freach/kubernetes-security-best-practice"),"."),Object(o.b)("h3",{id:"eks-pod-networking"},"EKS Pod Networking"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Amazon VPC CNI plugin: each pod receivers 1 IP address (=ENI => Elastic Network Interface) in VPC."),Object(o.b)("li",{parentName:"ul"},"Pods have the same IP address inside the EKS cluster and outside of it."),Object(o.b)("li",{parentName:"ul"},"Subnet limitations: CIRD /24 is 254 IP, not enough to run a lot of pods. You'll need a way bigger CIDR. Recommended is a CIDR /18."),Object(o.b)("li",{parentName:"ul"},"EC2 limitations: limited to amount of ENI/IP addresses it can have. Based on the network types, AWS has documentation on EC2 limits for ENIs, IPv4s and IPv6s.")),Object(o.b)("p",null,"See ",Object(o.b)("a",Object.assign({parentName:"p"},{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html"}),"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html")," for more information on ENI limits."),Object(o.b)("h3",{id:"network-security-with-calico"},"Network security with Calico"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Security groups allow all worker nodes to communicate to each other on any ports."),Object(o.b)("li",{parentName:"ul"},"This may be a problem if you want to segement applications, tenants or environments."),Object(o.b)("li",{parentName:"ul"},"You can use the Calico project instead of AWS Security Groups in this case."),Object(o.b)("li",{parentName:"ul"},"Network policies are directly assigned to pods (instead of worker nodes)."),Object(o.b)("li",{parentName:"ul"},"More granular.")),Object(o.b)("h3",{id:"iam-and-rbac-integration"},"IAM and RBAC Integration"),Object(o.b)("p",null,Object(o.b)("img",{alt:"IAM and RBAC in action",src:"https://res.cloudinary.com/gitgoodclub/image/upload/v1548215421/eks-course/Screen_Shot_2019-01-23_at_2.50.02_pm.png"})),Object(o.b)("p",null,'Note: RBAC means "Role-Based-Access-Control".'),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"When you talk to Kubernetes, authentication is held by IAM."),Object(o.b)("li",{parentName:"ul"},"Authorization is done by Kubernetes RBAC (native auth for K8s)."),Object(o.b)("li",{parentName:"ul"},"Done through collaboration between AWS and Heptio."),Object(o.b)("li",{parentName:"ul"},"You can assign RBAC directly through IAM entities."),Object(o.b)("li",{parentName:"ul"},"By default, the role you assign to your K8s cluster has system:master permissions.")),Object(o.b)("h3",{id:"k8s-worker-nodes"},"K8s Worker Nodes"),Object(o.b)("p",null,Object(o.b)("img",{alt:"K8s Worker Nodes",src:"https://res.cloudinary.com/gitgoodclub/image/upload/v1548216415/eks-course/Screen_Shot_2019-01-23_at_3.06.44_pm.png"})),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"When the join the cluster, they are assigned an IAM role and authorized in RBAC to join ",Object(o.b)("inlineCode",{parentName:"li"},"system:bootstrappers")," and ",Object(o.b)("inlineCode",{parentName:"li"},"system: nodes")," in your ConfigMap.")),Object(o.b)("p",null,"You can write your own rules in the ConfigMap."),Object(o.b)("h3",{id:"eks-load-balancers"},"EKS Load Balancers"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"EKS support ",Object(o.b)("inlineCode",{parentName:"li"},"Classic Load Balancer"),", ",Object(o.b)("inlineCode",{parentName:"li"},"Application Load Balancer")," and ",Object(o.b)("inlineCode",{parentName:"li"},"Network Load Balancer"),"."),Object(o.b)("li",{parentName:"ul"},"Classic and Network Load Balancer is for Service of type ",Object(o.b)("inlineCode",{parentName:"li"},"LoadBalancer"),"."),Object(o.b)("li",{parentName:"ul"},"Application Load Balancer is for Ingress Controller.")),Object(o.b)("h3",{id:"loadbalancer"},"LoadBalancer"),Object(o.b)("p",null,"Through the service of type ",Object(o.b)("inlineCode",{parentName:"p"},"LoadBalancer"),", EKS will create a:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Classic Load Balancer by default."),Object(o.b)("li",{parentName:"ul"},"Netword Load Balancer if this is specified: ",Object(o.b)("inlineCode",{parentName:"li"},"service.beta.kubernetes.io/aws-load-balancer-type:nlb"),"."),Object(o.b)("li",{parentName:"ul"},"There is also support for internal load balancers: ",Object(o.b)("inlineCode",{parentName:"li"},"service.beta.kubernetes.io//aws-load-balancer-internal:0.0.0.0/0"),"."),Object(o.b)("li",{parentName:"ul"},"You can control the configuration of LBs using annotations in your manifest."),Object(o.b)("li",{parentName:"ul"},"All documentation for ",Object(o.b)("inlineCode",{parentName:"li"},"LoadBalancer")," on AWS is diretly on the Kubernetes project."),Object(o.b)("li",{parentName:"ul"},"ALB Ingress is open source and found on GitHub."),Object(o.b)("li",{parentName:"ul"},"Supports target group of instance mode (hooked into NodePort)."),Object(o.b)("li",{parentName:"ul"},"Supports target group of IP mode (directly communicating with the pod)."),Object(o.b)("li",{parentName:"ul"},"Supports Application Load Balancer listener rules.")))}r&&r===Object(r)&&Object.isExtensible(r)&&Object.defineProperty(r,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"MDXContent",filename:"manual/Kubernetes/EKS-In-Depth.md"}}),r.isMDXComponent=!0}}]);
//# sourceMappingURL=manual-kubernetes-eks-in-depth.101a1afd2417ec7a4a77.js.map