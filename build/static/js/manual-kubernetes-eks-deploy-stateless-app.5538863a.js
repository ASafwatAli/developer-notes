(window.webpackJsonp=window.webpackJsonp||[]).push([[272],{"./manual/Kubernetes/EKS-Deploy-Stateless-App.md":function(e,n,t){"use strict";t.r(n),t.d(n,"default",function(){return i});var a=t("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),s=(t("./node_modules/react/index.js"),t("./node_modules/@mdx-js/react/dist/index.es.js")),l={},r="wrapper";function i(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(s.b)(r,Object.assign({},l,t,{components:n,mdxType:"MDXLayout"}),Object(s.b)("h1",{id:"eks---deploy-stateless-app"},"EKS - Deploy Stateless App"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",Object.assign({parentName:"li"},{href:"#eks---deploy-stateless-app"}),"EKS - Deploy Stateless App"),Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",Object.assign({parentName:"li"},{href:"#in-this-app"}),"In this app"),Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",Object.assign({parentName:"li"},{href:"#backend"}),"Backend")),Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",Object.assign({parentName:"li"},{href:"#frontend"}),"Frontend")))),Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",Object.assign({parentName:"li"},{href:"#deploying-the-backend"}),"Deploying the backend"),Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",Object.assign({parentName:"li"},{href:"#the-redis-master"}),"The Redis Master")),Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",Object.assign({parentName:"li"},{href:"#the-redis-slaves"}),"The Redis Slaves")))),Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",Object.assign({parentName:"li"},{href:"#deploying-the-frontend"}),"Deploying the Frontend")),Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",Object.assign({parentName:"li"},{href:"#scaling-pods-up-and-down"}),"Scaling Pods up and down"))))),Object(s.b)("p",null,"In this example, we will be build a basic guestbook example from Kubernetes."),Object(s.b)("h2",{id:"in-this-app"},"In this app"),Object(s.b)("p",null,"We will deploy the guestbook app at ",Object(s.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/kubernetes/examples/tree/master/guestbook"}),"https://github.com/kubernetes/examples/tree/master/guestbook"),"."),Object(s.b)("p",null,"We will need to deploy backend resources, frontend resources, scale Pods up/down and some chaos testing."),Object(s.b)("p",null,"Our application will be accessible from an AWS Load Balancer."),Object(s.b)("p",null,Object(s.b)("img",{alt:"App layout",src:"https://res.cloudinary.com/gitgoodclub/image/upload/v1548246181/eks-course/Screen_Shot_2019-01-23_at_11.22.49_pm.png"})),Object(s.b)("h3",{id:"backend"},"Backend"),Object(s.b)("p",null,"Redis:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Single Master (WRITES)"),Object(s.b)("li",{parentName:"ul"},"Multi Slaves (READ)"),Object(s.b)("li",{parentName:"ul"},"Slaves sync continuously from Master")),Object(s.b)("h3",{id:"frontend"},"Frontend"),Object(s.b)("p",null,"PHP App:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Load balanced to public with ELB"),Object(s.b)("li",{parentName:"ul"},"Read balanced over multiple salve DBs"),Object(s.b)("li",{parentName:"ul"},"Write req to single Master DB")),Object(s.b)("h2",{id:"deploying-the-backend"},"Deploying the backend"),Object(s.b)("p",null,"We need to create:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Redis Master pod"),Object(s.b)("li",{parentName:"ul"},"Redis Master service"),Object(s.b)("li",{parentName:"ul"},"Redis Slave pods"),Object(s.b)("li",{parentName:"ul"},"Redis Slave services")),Object(s.b)("p",null,"Then we will do some AWS networking (ENI) inspection."),Object(s.b)("h3",{id:"the-redis-master"},"The Redis Master"),Object(s.b)("pre",null,Object(s.b)("code",Object.assign({parentName:"pre"},{className:"language-yaml"}),"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: redis-master\n  labels:\n    app: redis\nspec:\n  selector:\n    matchLabels:\n      app: redis\n      role: master\n      tier: backend\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: redis\n        role: master\n        tier: backend\n    spec:\n      containers:\n        - name: master\n          image: k8s.gcr.io/redis:e2e # or just image: redis\n          resources:\n            requests:\n              cpu: 100m\n              memory: 100Mi\n          ports:\n            - containerPort: 6379\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: redis-master\n  labels:\n    app: redis\n    role: master\n    tier: backend\nspec:\n  ports:\n    - port: 6379\n      targetPort: 6379\n  selector:\n    app: redis\n    role: master\n    tier: backend\n")),Object(s.b)("p",null,"Apply this file using kubectl and then you can check what has been deployed. Notice there is a Cluster IP but not an external IP as it is not exposed to the public."),Object(s.b)("pre",null,Object(s.b)("code",Object.assign({parentName:"pre"},{className:"language-shell"}),"kubectl get svc\n\nNAME           TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE\nkubernetes     ClusterIP   [REDACTED]       <none>        443/TCP    1h\nredis-master   ClusterIP   [REDACTED]       <none>        6379/TCP   16s\n")),Object(s.b)("h3",{id:"the-redis-slaves"},"The Redis Slaves"),Object(s.b)("pre",null,Object(s.b)("code",Object.assign({parentName:"pre"},{className:"language-yml"}),"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: redis-slave\n  labels:\n    app: redis\nspec:\n  selector:\n    matchLabels:\n      app: redis\n      role: slave\n      tier: backend\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: redis\n        role: slave\n        tier: backend\n    spec:\n      containers:\n        - name: slave\n          image: gcr.io/google_samples/gb-redisslave:v1\n          resources:\n            requests:\n              cpu: 100m\n              memory: 100Mi\n          env:\n            - name: GET_HOSTS_FROM\n              value: dns\n          ports:\n            - containerPort: 6379\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: redis-slave\n  labels:\n    app: redis\n    role: slave\n    tier: backend\nspec:\n  ports:\n    - port: 6379\n  selector:\n    app: redis\n    role: slave\n    tier: backend\n")),Object(s.b)("p",null,"After applying the file, we can run ",Object(s.b)("inlineCode",{parentName:"p"},"kubectl get pods")," and see something similar to the following:"),Object(s.b)("pre",null,Object(s.b)("code",Object.assign({parentName:"pre"},{className:"language-shell"}),"NAME                            READY   STATUS    RESTARTS   AGE\nredis-master-6b464554c8-kqkpr   1/1     Running   0          7m\nredis-slave-b58dc4644-dk9cg     1/1     Running   0          12s\nredis-slave-b58dc4644-jx6mz     1/1     Running   0          12s\n")),Object(s.b)("h2",{id:"deploying-the-frontend"},"Deploying the Frontend"),Object(s.b)("pre",null,Object(s.b)("code",Object.assign({parentName:"pre"},{className:"language-yaml"}),"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: frontend\n  labels:\n    app: guestbook\nspec:\n  selector:\n    # matches Service\n    matchLabels:\n      app: guestbook\n      tier: frontend\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: guestbook\n        tier: frontend\n    spec:\n      containers:\n        - name: php-redis\n          image: gcr.io/google-samples/gb-frontend:v4\n          resources:\n            requests:\n              cpu: 100m\n              memory: 100Mi\n          env:\n            - name: GET_HOSTS_FROM\n              value: dns\n              # Using `GET_HOSTS_FROM=dns` requires your cluster to\n              # provide a dns service. As of Kubernetes 1.3, DNS is a built-in\n              # service launched automatically. However, if the cluster you are using\n              # does not have a built-in DNS service, you can instead\n              # access an environment variable to find the master\n              # service's host. To do so, comment out the 'value: dns' line above, and\n              # uncomment the line below:\n              # value: env\n          ports:\n            - containerPort: 80\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: frontend\n  labels:\n    app: guestbook\n    tier: frontend\nspec:\n  # comment or delete the following line if you want to use a LoadBalancer\n  #type: NodePort\n  # if your cluster supports it, uncomment the following to automatically create\n  # an external load-balanced IP for the frontend service.\n  type: LoadBalancer\n  ports:\n    - port: 80\n  selector:\n    app: guestbook\n    tier: frontend\n")),Object(s.b)("p",null,"After deploying, we should see all the pods and services deploying."),Object(s.b)("p",null,"If we then run ",Object(s.b)("inlineCode",{parentName:"p"},"kubectl describe service frontend"),", we should be able to see information on the ELB that we have just deployed."),Object(s.b)("p",null,"From this information, we should be able to fetch the ",Object(s.b)("inlineCode",{parentName:"p"},"LoadBalancer Ingress")," address to open up the guest book."),Object(s.b)("h2",{id:"scaling-pods-up-and-down"},"Scaling Pods up and down"),Object(s.b)("pre",null,Object(s.b)("code",Object.assign({parentName:"pre"},{className:"language-yml"}),"# Scale to 5 replicas of deployment frontend\nkubectl scale --replicas 5 deployment frontend\n# kubectl get pods will show us 5\nkubectl scale --replicas 4 deployment frontend\n# kubectl get pods will show us 4\n")))}i&&i===Object(i)&&Object.isExtensible(i)&&Object.defineProperty(i,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"MDXContent",filename:"manual/Kubernetes/EKS-Deploy-Stateless-App.md"}}),i.isMDXComponent=!0}}]);
//# sourceMappingURL=manual-kubernetes-eks-deploy-stateless-app.101a1afd2417ec7a4a77.js.map