(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{"./manual/Chef/Chef-Udemy.md":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return l});var a=n("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),o=(n("./node_modules/react/index.js"),n("./node_modules/@mdx-js/react/dist/index.es.js")),c={},i="wrapper";function l(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)(i,Object.assign({},c,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"chef---udemy-course"},"Chef - Udemy Course"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#chef---udemy-course"}),"Chef - Udemy Course"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#configuration-management"}),"Configuration Management")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#infrastructure-as-code"}),"Infrastructure as Code")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#your-first-chef-recipe"}),"Your First Chef Recipe")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#chef-resources"}),"Chef Resources")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#exploring-system-resources"}),"Exploring system resources")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#convergence-and-desired-state"}),"Convergence and Desired State")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#creating-an-exercise-work-station"}),'Creating an "Exercise Work Station"')),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#organising-resources-with-ruby"}),"Organising Resources with Ruby")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#cookbooks"}),"Cookbooks"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#how-do-you-keep-track-of-changes-to-the-recipes"}),"How do you keep track of changes to the recipes?")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#cookbook-components"}),"Cookbook Components")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#tracking-changes-to-the-cookbooks"}),"Tracking changes to the Cookbooks")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#setting-up-an-apache-cookbook"}),"Setting up an Apache Cookbook")))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#chef-client"}),"Chef Client"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#include_recipe"}),"include_recipe")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#defaultrb-example"}),"default.rb example")))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#ohai"}),"Ohai"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object.assign({parentName:"li"},{href:"#an-object-called-node"}),"An object called 'node'"))))))),Object(o.b)("h2",{id:"configuration-management"},"Configuration Management"),Object(o.b)("p",null,"Maintaining consistency for server integrity."),Object(o.b)("p",null,"The process of configuration can be automated by some extent. When you reach scale, this automation is at the heart of configuration management (IT orchetration)."),Object(o.b)("p",null,"Imagine we are deploying a web server. If we have a config management solution, this could take minutes instead of hours."),Object(o.b)("p",null,"System auditing will also be a hassle for disaster recovery too."),Object(o.b)("p",null,"Revision control systems can also be version controlled with ",Object(o.b)("inlineCode",{parentName:"p"},"infrastructure as code")," by having these environments scripted."),Object(o.b)("h2",{id:"infrastructure-as-code"},"Infrastructure as Code"),Object(o.b)("p",null,"Examples:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"version control"),Object(o.b)("li",{parentName:"ul"},"testing")),Object(o.b)("p",null,"These all helps to validate infrastructure code."),Object(o.b)("p",null,"You can manage multiple cloud platforms etc."),Object(o.b)("p",null,"The three things covered:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"chef development kit"),Object(o.b)("li",{parentName:"ul"},"chef client"),Object(o.b)("li",{parentName:"ul"},"chef server")),Object(o.b)("p",null,"The Chef DK allows you to run local tools to write code and then upload it to a chef server. A node will be a server or machine managed by Chef."),Object(o.b)("p",null,"You will get the desired state from the ",Object(o.b)("inlineCode",{parentName:"p"},"cookbooks")," or ",Object(o.b)("inlineCode",{parentName:"p"},"recipes"),"."),Object(o.b)("h2",{id:"your-first-chef-recipe"},"Your First Chef Recipe"),Object(o.b)("p",null,"Create a new file ",Object(o.b)("inlineCode",{parentName:"p"},"hello.rb")," and add ",Object(o.b)("inlineCode",{parentName:"p"},"hello.txt")," with Hello World."),Object(o.b)("p",null,"First, give Chef a file."),Object(o.b)("p",null,"Inside of the file:"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-ruby"}),"file '/hello.txt' do\n    content 'Hello world!'\nend\n")),Object(o.b)("p",null,"Running ",Object(o.b)("inlineCode",{parentName:"p"},"sudo chef-client --client-mode hello.rb")," will then build that file and update the content."),Object(o.b)("h2",{id:"chef-resources"},"Chef Resources"),Object(o.b)("p",null,"Chef Resources are the fundamental building blocks of working with Chef."),Object(o.b)("p",null,"The aim is to build the load balancer."),Object(o.b)("p",null,"Resources describe the smallest piece we can configure in the system."),Object(o.b)("h2",{id:"exploring-system-resources"},"Exploring system resources"),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Example 1: Package Resource")),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{}),"## Install the http package\npackage 'httd' do\n    action :install\nend\n")),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Example 2: Service Resource")),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{}),"## Run the ntp service\nservice 'ntp' do\n    action [ :enable, :start ]\nend\n")),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Example 3: File Resource")),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{}),"## Create the /etc/motd file\nfile 'etc/motd' do\n    content 'This computer is the property ...'\nend\n")),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Example 4: File Resource")),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{}),"## Remove a file\nfile 'etc/php.ini.default' do\n    action :delete\nend\n")),Object(o.b)("p",null,"Looking back at the definition of a recipe. ",Object(o.b)("inlineCode",{parentName:"p"},"hello.rb")," was an example of a recipe file."),Object(o.b)("p",null,'The "type" (eg file, service, package) and "name" (filename, filepath) should be action\'d with "properties" (eg content \'Hello World!\'). When we list a resource, we take ',Object(o.b)("inlineCode",{parentName:"p"},"action")," on that resource (eg ",Object(o.b)("inlineCode",{parentName:"p"},"action :create"),", ",Object(o.b)("inlineCode",{parentName:"p"},"action :delete"),", ",Object(o.b)("inlineCode",{parentName:"p"},"action :enable"),"). The default action is taken if you do not list the action. The default is more of a ",Object(o.b)("inlineCode",{parentName:"p"},"create")," or ",Object(o.b)("inlineCode",{parentName:"p"},"install")," - it is important to know about what it is as you are writing out recipes."),Object(o.b)("h2",{id:"convergence-and-desired-state"},"Convergence and Desired State"),Object(o.b)("p",null,"With the command ",Object(o.b)("inlineCode",{parentName:"p"},"sudo chef-client --local-mode hello.rb"),", when we run ",Object(o.b)("inlineCode",{parentName:"p"},"--local-mode")," we did it because the default mode is to talk to a ",Object(o.b)("inlineCode",{parentName:"p"},"chef server"),". Once we have a Chef server to work with, we can not use this mode."),Object(o.b)("p",null,"What happens if you modify the content of the file that we create directly, what happens when Chef runs again?"),Object(o.b)("p",null,"Chef will then attempt to ",Object(o.b)("inlineCode",{parentName:"p"},"repair")," the file changes."),Object(o.b)("p",null,'If we change the ownership for a file, Chef will only take action when it needs to. It will only take action if something is "out of policy".'),Object(o.b)("h2",{id:"creating-an-exercise-work-station"},'Creating an "Exercise Work Station"'),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-ruby"}),"# creating tree and ntp\npackage 'tree' do\n    action :install\nend\n\npackage 'ntp'\n\n# /etc/motd - content ownership\nfile '/etc/motd' do\n    content 'This is the property of me'\n    action :create\n    owner 'root'\n    group 'root'\nend\n")),Object(o.b)("p",null,"You can also build an array and pass it into a package resource, but if we do that we won't have access to things like versions etc."),Object(o.b)("p",null,"Then we can just run ",Object(o.b)("inlineCode",{parentName:"p"},"sudo chef-client -z setup.rb"),"."),Object(o.b)("p",null,"If we re-run the script, no actions will be taken if nothing needs to be modified."),Object(o.b)("h2",{id:"organising-resources-with-ruby"},"Organising Resources with Ruby"),Object(o.b)("p",null,"You can also call recipes from other recipes."),Object(o.b)("p",null,"Chef also runs the Ruby files synchronously."),Object(o.b)("h2",{id:"cookbooks"},"Cookbooks"),Object(o.b)("p",null,"Ways to group recipes and put them into useful configurations."),Object(o.b)("p",null,"Instead of a single recipe being sent to a server, we send a ",Object(o.b)("inlineCode",{parentName:"p"},"cookbook"),"."),Object(o.b)("h3",{id:"how-do-you-keep-track-of-changes-to-the-recipes"},"How do you keep track of changes to the recipes?"),Object(o.b)("p",null,"Cookbooks allow a way to package up the recipes and give it a version number and track changes."),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"A fundamental unit of configuration and policy distribution")),Object(o.b)("p",null,"When creating the cookbook, is describes a config for a particular scenario."),Object(o.b)("p",null,"What to use cookbooks for:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Specifiy resources to use and in which order they are applied"),Object(o.b)("li",{parentName:"ul"},"Attribute values"),Object(o.b)("li",{parentName:"ul"},"File distributions"),Object(o.b)("li",{parentName:"ul"},"Templates"),Object(o.b)("li",{parentName:"ul"},"Extensions to Chef (lib, definitions and custom resources)"),Object(o.b)("li",{parentName:"ul"},"Version Control")),Object(o.b)("p",null,"Cookbook components:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"README"),Object(o.b)("li",{parentName:"ul"},"metadata"),Object(o.b)("li",{parentName:"ul"},"recipes"),Object(o.b)("li",{parentName:"ul"},"testing directories (spec + test)")),Object(o.b)("h3",{id:"cookbook-components"},"Cookbook Components"),Object(o.b)("p",null,"We can create cookbooks by using ",Object(o.b)("inlineCode",{parentName:"p"},"chef generate [cookbook|other]"),"."),Object(o.b)("p",null,"When we generate a cookbook, we should give the cookbook a relevant name. Example ",Object(o.b)("inlineCode",{parentName:"p"},"chef generate cookbooks/workstation")," to create a ",Object(o.b)("inlineCode",{parentName:"p"},"workstation")," book in the ",Object(o.b)("inlineCode",{parentName:"p"},"cookbooks")," folder."),Object(o.b)("h3",{id:"tracking-changes-to-the-cookbooks"},"Tracking changes to the Cookbooks"),Object(o.b)("p",null,"Inside of a single repository, changes are generally tracked for a single cook book."),Object(o.b)("h3",{id:"setting-up-an-apache-cookbook"},"Setting up an Apache Cookbook"),Object(o.b)("p",null,"First, create a new cookbook in the cookbooks foler using ",Object(o.b)("inlineCode",{parentName:"p"},"chef generate cookbook cookbooks/apache")),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-ruby"}),"# Server\n\n# 1. http package install (redhat)\npackage 'httpd' do\n    action :install\nend\n\n# 2. configure default apache server file /var/www/html\nfile '/var/www/html/index.html' do\n    content '<h1>Hello from Apache</h1>'\nend\n\n# 3. download apache, enable and start the apache service\npackage 'apache' do\n    action :install\nend\n\nservice 'httpd' do\n    action [ :enable, :start ]\nend\n")),Object(o.b)("h2",{id:"chef-client"},"Chef Client"),Object(o.b)("p",null,"How do we apply the recipes from the cookbooks from the Chef client? How do we call multiple recipes at once?"),Object(o.b)("p",null,"We can use a cook book to define the scenarios here."),Object(o.b)("p",null,"Say we want to call a cookbook from a particular recipe."),Object(o.b)("p",null,"We can also do ",Object(o.b)("inlineCode",{parentName:"p"},'sudo chef-client -z --runlist "recipe[cookbook::recipe]"')," to run a particular recipe."),Object(o.b)("p",null,"For running multiple cookbook recipes, we could do ",Object(o.b)("inlineCode",{parentName:"p"},'sudo chef-client -z --runlist "recipe[cookbook::recipe],recipe[another-cookbook::recipe]"'),". This will do a ",Object(o.b)("inlineCode",{parentName:"p"},"chef-client")," run in order."),Object(o.b)("p",null,"The runlist DOES NOT HAVE A SPACE between recipe declarations."),Object(o.b)("h3",{id:"include_recipe"},"include_recipe"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"include_recipe")," method allows you to include a recipe from either the online cookbook stores or from one of our own cookbooks."),Object(o.b)("p",null,"This is a great way to ",Object(o.b)("inlineCode",{parentName:"p"},"wrap")," cookbooks."),Object(o.b)("p",null,"Each of the cookbooks that we generate come with a ",Object(o.b)("inlineCode",{parentName:"p"},"default.rb")," recipe. This default recipe can help us call other recipes."),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-ruby"}),"# in the default.rb file for a recipe\n\n# example 'cookbook::recipe'\ninclude_recipe 'workstation::setup'\n")),Object(o.b)("p",null,"If we now run ",Object(o.b)("inlineCode",{parentName:"p"},'sudo chef-client -z -r "recipe[workstation]"')," and omit the specific recipe, then the ",Object(o.b)("inlineCode",{parentName:"p"},"default.rb")," recipe will be used."),Object(o.b)("h3",{id:"defaultrb-example"},"default.rb example"),Object(o.b)("p",null,"Including the server recipe from the apache cookbook."),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-ruby"}),"include_recipe 'apache::server'\n")),Object(o.b)("p",null,'Now we can call sudo chef-client -z -r "recipe',"[apache]",'"`.'),Object(o.b)("h2",{id:"ohai"},"Ohai"),Object(o.b)("p",null,"We need to think about distribution of the cookbooks to many different nodes."),Object(o.b)("p",null,"We may need to know a bit of information about that ",Object(o.b)("inlineCode",{parentName:"p"},"node"),". That's where ",Object(o.b)("inlineCode",{parentName:"p"},"ohai")," comes in."),Object(o.b)("h3",{id:"an-object-called-node"},"An object called 'node'"),Object(o.b)("p",null,"We can now begin to start thinking of scale - how to deal with 100s or 1000s or similar servers."),Object(o.b)("p",null,"This webserver code that we have could be distributed to thousands of nodes, but the config might need to be different on each of these nodes."),Object(o.b)("p",null,"What happens if a host specific config needs to be different? Eg. hostname, memory available, IP address etc. These things may very from system to system."),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"Ohai")," is a system discovery tool. It's a command line tool that is required by ",Object(o.b)("inlineCode",{parentName:"p"},"chef-client"),"."),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"ohai")," gives back all the node system data in JSON. Everytime ",Object(o.b)("inlineCode",{parentName:"p"},"chef-client")," is run, it automatically executes an ",Object(o.b)("inlineCode",{parentName:"p"},"ohai")," and allows this object (known as the node object) to be accessed. We call these attributes available as ",Object(o.b)("inlineCode",{parentName:"p"},"node attributes"),". Each ",Object(o.b)("inlineCode",{parentName:"p"},"attribute")," also has ",Object(o.b)("inlineCode",{parentName:"p"},"sub-attributes"),"."))}l&&l===Object(l)&&Object.isExtensible(l)&&Object.defineProperty(l,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"MDXContent",filename:"manual/Chef/Chef-Udemy.md"}}),l.isMDXComponent=!0}}]);
//# sourceMappingURL=manual-chef-chef-udemy.101a1afd2417ec7a4a77.js.map