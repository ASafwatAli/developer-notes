{"version":3,"sources":["/Users/dennis.okeeffe/Project-Imposter/developer-notes/manual/JavaScript/O-Auth-With-Passport.md"],"names":["layoutProps","MDXLayout","MDXContent","_ref","components","props","Object","_Users_dennis_okeeffe_Project_Imposter_developer_notes_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__","_mdx_js_react__WEBPACK_IMPORTED_MODULE_2__","assign","mdxType","parentName","start","href","isMDXComponent"],"mappings":"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","file":"static/js/manual-java-script-o-auth-with-passport.f92dea07.js","sourcesContent":["/* @jsx mdx */\n  import React from 'react'\n  import { mdx } from '@mdx-js/react'\n  /* @jsx mdx */\n\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`OAUTH AND PASSPORT FOR EXPRESS`}</p>\n    <p>{`/////////////////////////////////////////////////////////`}</p>\n    <p>{`/`}<strong parentName=\"p\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\">{`****`}</strong></strong></strong></strong></strong></strong></p>\n    <ul>\n      <li parentName=\"ul\"><pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`                    *\n`}</code></pre><ol parentName=\"li\">\n          <li parentName=\"ol\">{`What is OAuth?`}</li>\n        </ol></li>\n      <li parentName=\"ul\"><pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`                    *\n`}</code></pre><strong parentName=\"li\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\">{`****`}</strong></strong></strong></strong></strong></strong>{`/`}</li>\n    </ul>\n    <p>{`It is authorization, not authentication.`}</p>\n    <p>{`Authorization is used for what you can do.`}</p>\n    <p>{`You usually get tokens...`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Access Token`}</li>\n      <li parentName=\"ul\">{`Refresh Token`}</li>\n    </ul>\n    <p>{`/`}<strong parentName=\"p\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\">{`****`}</strong></strong></strong></strong></strong></strong></p>\n    <ul>\n      <li parentName=\"ul\"><pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`                    *\n`}</code></pre><ol parentName=\"li\" {...{\n          \"start\": 2\n        }}>\n          <li parentName=\"ol\">{`Setting up Passport`}</li>\n        </ol></li>\n      <li parentName=\"ul\"><pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`                    *\n`}</code></pre><strong parentName=\"li\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\">{`****`}</strong></strong></strong></strong></strong></strong>{`/`}</li>\n    </ul>\n    <p>{`// THE SETUP STRATERGY`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Install Strategy`}</li>\n      <li parentName=\"ol\">{`Create 'Application' on OAuth Provider`}</li>\n      <li parentName=\"ol\">{`Configure Strategy`}</li>\n      <li parentName=\"ol\">{`Create routes for the provider`}</li>\n    </ol>\n    <p>{`// installing Github auth`}</p>\n    <p>{`npm install passport-github --save`}</p>\n    <ul>\n      <li parentName=\"ul\">{`from here you can register the application on Github in settings`}</li>\n      <li parentName=\"ul\">{`grab tokens`}</li>\n    </ul>\n    <p>{`|||||||||||||||||||||||||||||||||||||||||||||`}</p>\n    <p>{`npm install passport --save\nnpm install express-session --save`}</p>\n    <p>{`We'll use persistent session store with mongoDB to keep the login persistent`}</p>\n    <p>{`// in app.js`}</p>\n    <p>{`var passport = require('passport');\nvar GitHubStrategy = require('passport-github').Strategy;\nvar FacebookStrategy = require('passport-facebook').Strategy;\nvar session = require('express-session');\nvar MongoStore = require('connect-mongo')(session);`}</p>\n    <p>{`function generateOrFindUser (accessToken, refreshToken, profile, done) {\nUser.findOneAndUpdate({\nemail: profile.emails`}{`[0]`}{`.value\n}, {\nname: profile.displayName || profile.username,\nemail: profile.emails`}{`[0]`}{`.value,\nphoto: profile.photos`}{`[0]`}{`.value\n}, {\nupsert: true\n},\ndone);\n} else {\nvar noEmailError = new Error(\"Your email privacy settings prevent you from signing into bookworm!\");\ndone(noEmailError, null);\n}\n}`}</p>\n    <p>{`// config the strategy\npassport.use(new GitHubStrategy({\n// do not enter your actual ID and Key here!\nclientID: process.env.GITHUB_CLIENT_ID,\nclientSecret: process.env.GITHUB_CLIENT_SECRET,\ncallbackURL: \"`}<a parentName=\"p\" {...{\n        \"href\": \"http://localhost:3000/auth/github/return\"\n      }}>{`http://localhost:3000/auth/github/return`}</a>{`\"\n}, generateOrFindUser));`}</p>\n    <p>{`passport.use(new FacebookStrategy({\n// do not enter your actual ID and Key here!\nclientID: process.env.FACEBOOK_APP_ID,\nclientSecret: process.env.FACEBOOK_APP_SECRET,\ncallbackURL: \"`}<a parentName=\"p\" {...{\n        \"href\": \"http://localhost:3000/auth/facebook/return%22\"\n      }}>{`http://localhost:3000/auth/facebook/return\"`}</a>{`,\nprofileFields: `}{`['id', 'displayName', 'photos', 'email']`}{`\n}), generateOrFindUser);`}</p>\n    <p>{`passport.serializeUser(function (user, done) {\ndone(null, user._id);\n});`}</p>\n    <p>{`passport.deserializeUser(function(userId, done) {\nUser.findById(userId, done); // done is a callback function\n});`}</p>\n    <p>{`...`}</p>\n    <p>{`var auth = require('./routes/auth');`}</p>\n    <p>{`...`}</p>\n    <p>{`// after db connection\n// Session config for Passport and MongoDB`}</p>\n    <p>{`var sessionOptions = {\nsecret: \"this is a super secret dadada\",\nresave: true,\nsaveUninitialized: true,\nstore: new MongoStore({\nmongooseConnection: db\n})\n}`}</p>\n    <p>{`app.use(session(sessionOptions));`}</p>\n    <p>{`// Init Passport\napp.use(passport.initialize());`}</p>\n    <p>{`// Restore Session\napp.use(passport.session());`}</p>\n    <p>{`app.use('/auth', auth);`}</p>\n    <p>{`// in routes > auth.js`}</p>\n    <p>{`var express = require('express');\nvar router = express.Router();\nvar passport = require('passport');`}</p>\n    <p>{`// Get /auth/login/github`}</p>\n    <p>{`router.get('/login/github',\npassport.authenticate('github'));`}</p>\n    <p>{`// Get /auth/github/return`}</p>\n    <p>{`router.get('/github/return',\npassport.authenticate('github', {failedRedirect: '/'}),\nfunction(req, res) {\n//Succes Auth, redirect to page for now\nres.redirect('/profile');\n});`}</p>\n    <p>{`// Get /auth/login/facebook`}</p>\n    <p>{`router.get('/login/facebook',\npassport.authenticate('facebook', { scope: `}{`[\"email\"]`}{`}));`}</p>\n    <p>{`// Get /auth/facebook/return`}</p>\n    <p>{`router.get('/facebook/return',\npassport.authenticate('facebook', {failedRedirect: '/'}),\nfunction(req, res) {\n//Succes Auth, redirect to page for now\nres.redirect('/profile');\n});`}</p>\n    <p>{`// GET /auth/logout`}</p>\n    <p>{`router.get('/logout', function(req, res) {\nreq.logout();\nres.redirect('/');\n})`}</p>\n    <p>{`module.exports = router;`}</p>\n    <p>{`// to use vars in command line...`}</p>\n    <blockquote>\n      <p parentName=\"blockquote\">{`GITHUB_CLIENT_ID=123432 GITHUB_CLIENT_SECRET=892u3rw9u ./bin/www`}</p>\n    </blockquote>\n    </MDXLayout>;\n}\n\nMDXContent.isMDXComponent = true;\n  "],"sourceRoot":""}